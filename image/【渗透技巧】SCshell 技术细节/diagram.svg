<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="899" height="545" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Title:SCshell 时序图
Client ->> Client:启用 LogonUserA， 本地登陆一个账户，获取当前登陆令牌的句柄（注意 lpszDomain 参数的解释）
Client ->> Client:启用 ImpersonateLoggedOnUser，允许此程序模拟登陆用户
Client -->> Server:使用 OpenSCManagerA 与指定计算机建立的服务控制管理器的连接，并打开指定的服务控制管理器数据库
Server -->> Client:返回指定服务控制管理器数据库的句柄
Client -->> Server:根据返回的数据库句柄，利用 OpenServiceA 通过服务控制管理器打开现有服务
Server -->> Client:返回指定服务的句柄
Client -->> Server:根据返回的服务句柄，使用 QueryServiceConfigA 查看此服务的配置信息，获取原始服务路径
Client -->> Server:使用 ChangeServiceConfigA 对该服务进行配置更改
Client -->> Server:使用 StartServiceA 启动更改后的服务
Client -->> Server:再次使用 ChangeServiceConfigA 进行服务路径还原]]></source><desc>SCshell 时序图</desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"><rect x="10" y="10" width="134.734375" height="28" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="15" y="30" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="15">SCshell 时序图</tspan></text></g><g class="actor"><rect x="10" y="48" width="77.578125" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="73" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">Client</tspan></text></g><g class="actor"><rect x="10" y="487.53125" width="77.578125" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="512.53125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">Client</tspan></text></g><line x1="48.7890625" x2="48.7890625" y1="86" y2="487.53125" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="791.984375" y="48" width="77.578125" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="801.984375" y="73" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="801.984375">Server</tspan></text></g><g class="actor"><rect x="791.984375" y="487.53125" width="77.578125" height="38" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="801.984375" y="512.53125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="801.984375">Server</tspan></text></g><line x1="830.7734375" x2="830.7734375" y1="86" y2="487.53125" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="signal"><text x="73.7890625" y="120.109375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="73.7890625">启用 LogonUserA， 本地登陆一个账户，获取当前登陆令牌的句柄（注意 lpszDomain 参数的解释）</tspan></text><line x1="48.7890625" x2="68.7890625" y1="106" y2="106" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="68.7890625" x2="68.7890625" y1="106" y2="129.21875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="68.7890625" x2="48.7890625" y1="129.21875" y2="129.21875" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="73.7890625" y="158.328125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="73.7890625">启用 ImpersonateLoggedOnUser，允许此程序模拟登陆用户</tspan></text><line x1="48.7890625" x2="68.7890625" y1="144.21875" y2="144.21875" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="68.7890625" x2="68.7890625" y1="144.21875" y2="167.4375" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="68.7890625" x2="48.7890625" y1="167.4375" y2="167.4375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="59.203125" y="193.328125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="59.203125">使用 OpenSCManagerA 与指定计算机建立的服务控制管理器的连接，并打开指定的服务控制管理器数据库</tspan></text><line x1="48.7890625" x2="830.7734375" y1="200.65625" y2="200.65625" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="303.859375" y="231.65625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="303.859375">返回指定服务控制管理器数据库的句柄</tspan></text><line x1="830.7734375" x2="48.7890625" y1="238.65625" y2="238.65625" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="148.75" y="269.546875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="148.75">根据返回的数据库句柄，利用 OpenServiceA 通过服务控制管理器打开现有服务</tspan></text><line x1="48.7890625" x2="830.7734375" y1="276.875" y2="276.875" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="367.8203125" y="307.875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="367.8203125">返回指定服务的句柄</tspan></text><line x1="830.7734375" x2="48.7890625" y1="314.875" y2="314.875" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="91.1796875" y="345.765625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="91.1796875">根据返回的服务句柄，使用 QueryServiceConfigA 查看此服务的配置信息，获取原始服务路径</tspan></text><line x1="48.7890625" x2="830.7734375" y1="353.09375" y2="353.09375" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="238.2890625" y="383.984375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="238.2890625">使用 ChangeServiceConfigA 对该服务进行配置更改</tspan></text><line x1="48.7890625" x2="830.7734375" y1="391.3125" y2="391.3125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="287.859375" y="422.3125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="287.859375">使用 StartServiceA 启动更改后的服务</tspan></text><line x1="48.7890625" x2="830.7734375" y1="429.3125" y2="429.3125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g><g class="signal"><text x="238.2890625" y="460.203125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="238.2890625">再次使用 ChangeServiceConfigA 进行服务路径还原</tspan></text><line x1="48.7890625" x2="830.7734375" y1="467.53125" y2="467.53125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"></line></g></svg>